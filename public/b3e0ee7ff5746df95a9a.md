---
title: DiscordTokenが流出した話
tags:
  - token
  - discord
private: false
updated_at: '2024-12-20T18:38:21+09:00'
id: b3e0ee7ff5746df95a9a
organization_url_name: null
slide: false
ignorePublish: false
---
こんにちは。この記事では、私のDiscordTokenが流出してしまった体験談と、その原因や対策についてお話しします。この出来事は、私にとって大きな教訓となりました。同じ失敗を繰り返さないためにも、共有したいと思います。

## 背景

私はDiscordのBotを開発している最中、ローカル環境でテストを行うため、Tokenをコード内に直接記述していました。このコードはGitでバージョン管理を行っており、Tokenもそのままコミットされ、最終的にプライベートリポジトリにプッシュされていました。

多くの方が「プライベートリポジトリなら安全」と考えるかもしれません。しかし、GitHubのプライベートリポジトリであっても、Tokenを直置きすることは非常に危険です。万が一、アカウントが乗っ取られたり、共有設定にミスがあった場合、機密情報が第三者に流出するリスクがあります。

流出に気づいたきっかけは、Botが意図しない動作を始めたり、他人が私のBotを操作している形跡を見つけたことでした。この時点で、Tokenが悪用されていることを確信しました。

以下は、問題が発覚した際に確認した被害の一例です。


![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3474929/8fdc1700-9b44-fd21-a311-818d872b46be.png)
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3474929/ee8ac320-2ee4-a4c8-04b8-21faabf09f07.png)

## 流出の原因

Tokenが流出した主な原因を以下にまとめます。

1. **Tokenをハードコーディングしていた**
   - Tokenをコード内に直接記述し、セキュリティ意識が不足していました。

2. **Gitリポジトリへのコミット**
   - `.gitignore`を適切に設定しておらず、環境変数や秘密情報を管理する基本を怠りました。

3. **プライベートリポジトリへの過信**
   - プライベートリポジトリなら安全だと誤解し、Tokenをリポジトリ内に保存していました。

## 問題発覚後の対応

問題に気づいた後、以下の対応を迅速に行いました。

1. **Tokenの再生成**
   - Discordの開発者ポータルにアクセスし、流出したTokenを無効化、新しいTokenを発行しました。

2. **アクセスログの確認**
   - DiscordのAPIログを確認し、不審なアクセスがないかを調査しました。

3. **セキュリティ対策の強化**
   - Tokenや機密情報の管理方法を全面的に見直し、以下の対策を実施しました。
     - 環境変数（`.env`ファイル）を利用してTokenを管理。
     - `.gitignore`を設定し、機密情報がコミットされないようにしました。

## 教訓と今後の改善

今回の失敗を通じて、以下の重要なポイントを学びました。

- **プライベートリポジトリへの過信は禁物**
  - プライベートリポジトリであっても、Tokenや機密情報を直接保存してはいけません。

- **公開リポジトリでのセキュリティ意識を高める**
  - リポジトリを公開する前に、機密情報が含まれていないか必ず確認します。

- **定期的なセキュリティチェック**
  - リポジトリやAPIの設定を定期的に見直し、潜在的な脆弱性を排除します。

## まとめ

今回のToken流出は非常に苦い経験でしたが、貴重な教訓となりました。この記事を読んでくださった皆さんには、私の経験を通じてセキュリティ意識を高めていただければと思います。
